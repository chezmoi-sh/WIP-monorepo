---
# Copyright 2024
#
# Everyone is permitted to copy, distribute, modify, merge, sell, publish,
# sublicense or whatever the fuck they want with this software but at their
# OWN RISK.
# The author has absolutely no fucking clue what the code in this project
# does. It might just fucking work or not, there is no third option.
#
# IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
# DEALINGS IN THE SOFTWARE.
# ---
version: "3.8"

services:
  # ┌───────────────────────────────────────────────────────────────────────────────────┐
  # │ Homer: A very simple static homepage for your server.                             │
  # │                                                                                   │
  # │ Docs: https://github.com/bastienwirtz/homer/blob/main/README.md#table-of-contents │
  # └───────────────────────────────────────────────────────────────────────────────────┘
  home-dashboard:
    image: oci.chezmoi.sh/localhost/alpine/homer:stable
    cap_drop:
      - ALL
    networks:
      caddy-internal:
      default: # NOTE: Required for 3rd-party services to fetch API
    read_only: true
    restart: unless-stopped
    user: lighttpd
  # ┌───────────────────────────────────────────────────────────────────────────┐
  # │ Nut Ups Daemon - Network UPS Tools                                        │
  # │                                                                           │
  # │ Docs: https://www.networkupstools.org/                                    │
  # └───────────────────────────────────────────────────────────────────────────┘
  upsd:
    image: oci.chezmoi.sh/localhost/alpine/nut-upsd:stable
    cap_add:
      - CHOWN # Required to change the ownership of the USB device to the nut user.
      - SETGID # Required to run the `upsd` command as the nut user.
      - SETUID # Required to run the `upsd` command as the nut user.
    cap_drop:
      - ALL
    devices:
      - /dev/bus/usb:/dev/bus/usb
    networks:
      caddy-internal:
    ports:
      - 3493:3493/tcp
    read_only: true
    restart: unless-stopped
    # NOTE: Required to change the ownership of the USB device to the nut user.
    #       However, everything is running as nut user inside the container
    #       using the Busybox `su`.
    tmpfs:
      - /var/run/nut
    user: root

  # ┌───────────────────────────────────────────────────────────────────────────┐
  # │ Gatus: A simple, fast and scalable status page for your services and APIs.│
  # │                                                                           │
  # │ Docs: https://gatus.io/docs                                               │
  # └───────────────────────────────────────────────────────────────────────────┘
  status-page:
    image: oci.chezmoi.sh/localhost/alpine/gatus:stable
    cap_drop:
      - ALL
    networks:
      caddy-internal:
      default: # NOTE: Required for 3rd-party services to receive alerts
    read_only: true
    restart: unless-stopped
    user: gatus
    volumes:
      - gatus-perstistent:/var/lib/gatus

volumes:
  gatus-perstistent:
